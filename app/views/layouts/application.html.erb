<!DOCTYPE html>
<html>
  <head>
    <title>iiiEx Extra 2020</title>
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>
    <meta name="google-site-verification" content="VETo6o87DVeKuVpRFQt2wSNF8KOxItRisB0veZQTF5I" />

    <%= stylesheet_link_tag 'application', media: 'all' %>
    <%= javascript_packs_with_chunks_tag 'application' %>
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css" />
    <script src="https://www.googletagmanager.com/gtag/js?id=UA-170084949-1" type="text/javascript"></script>
    <script>
        const GA_MEASUREMENT_ID = 'UA-170084949-1'
        window['ga-disable-' + GA_MEASUREMENT_ID] = true;
        function gtag(){};
    </script>
  </head>

  <body>
    <%= yield %>
    <script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js" data-cfasync="false"></script>
    <script>
        const enableGA = () => {
             let gaInitialize = document.createElement('script');
             if (document.getElementById('gaInitialize') === null) {
                 gaInitialize.setAttribute('id', 'gaInitialize');
                 gaInitialize.innerHTML = `
                    window.dataLayer = window.dataLayer || [];
                    function gtag(){dataLayer.push(arguments);}
                    gtag('js', new Date());gtag('config', '${GA_MEASUREMENT_ID}');
                 `;
                 document.head.appendChild(gaInitialize);
             }
            window['ga-disable-' + GA_MEASUREMENT_ID] = false;
        };
        const disableGA = () => {
            window['ga-disable-' + GA_MEASUREMENT_ID] = true;
            document.cookie = '_ga=; max-age=0';
            document.cookie = '_gid=; max-age=0';
            document.cookie = '_gat=; max-age=0';
            document.cookie = 'AMP_TOKEN=; max-age=0';
            document.cookie = '_gat_gtag_' + GA_MEASUREMENT_ID + '=; max-age=0';
            document.cookie = '__utma=; max-age=0;';
            document.cookie = '__utmt=; max-age=0;';
            document.cookie = '__utmb=; max-age=0;';
            document.cookie = '__utmc=; max-age=0;';
            document.cookie = '__utmz=; max-age=0;';
            document.cookie = '__utmv=; max-age=0;';
        }
        const deleteCookies = () => {
        }

        let messageText = "クッキーを利用しています．";
        let dismissText = "はい";
        let allowText = "同意";
        let linkText = "クッキーポリシー";
        window.cookieconsent.initialise({
            "palette": {
                "popup": {
                    "background": "#eb6c44",
                    "text": "#ffffff"
                },
                "button": {
                    "background": "#f5d948"
                }
            },
            "theme": "classic",
            "position": "bottom-left",
            "type": "opt-in",
            "content": {
                "message": messageText,
                "dismiss": dismissText,
                "allow": allowText,
                "link": linkText,
                "href": "https://www.iiiexhibition.com/cookiepolicy.html"
            },
            onInitialise: function (status) {
                var type = this.options.type;
                var didConsent = this.hasConsented();
                if (type == 'opt-in' && didConsent) {
                    // enable cookies
                    enableGA();
                }
                if (type == 'opt-out' && !didConsent) {
                    // disable cookies
                    disableGA();
                }
            },
            onStatusChange: function(status, chosenBefore) {
                var type = this.options.type;
                var didConsent = this.hasConsented();
                if (type == 'opt-in' && didConsent) {
                    // enable cookies
                    enableGA();
                }
                if (type == 'opt-out' && !didConsent) {
                    // disable cookies
                    disableGA();
                }
            },
            onRevokeChoice: function() {
                var type = this.options.type;
                if (type == 'opt-in') {
                    // disable cookies
                    disableGA();
                }
                if (type == 'opt-out') {
                    // enable cookies
                    enableGA();
                }
            }
        });
    </script>
  </body>
</html>
